import{_ as Z}from"./AppPage-DFRzwKdu.js";import{u as F,b as h,_ as j}from"./useForm-CG-yDGX1.js";import{b5 as M,aZ as G,a$ as g,l as H,z as K,A as L,B as t,I as a,b0 as Q,J as r,D as l,F as _,al as W,E as d,bd as X,aM as Y,b1 as b,co as ee}from"./index-DrZMjmv9.js";import{_ as ae}from"./Avatar-DhZoxkIh.js";import{a as le,_ as te}from"./DescriptionsItem-jYHe4u69.js";import{_ as ne}from"./Input-AGQs7Bn2.js";import{a as oe}from"./Select-B6wqMYzm.js";import"./TheFooter-D-cLa1qG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-D5SwkeWV.js";import"./Tag-BrLFFiz0.js";import"./Eye-CJXJszYF.js";import"./create-BGkfZJ4H.js";const y={changePassword:m=>M.post("/auth/password",m),updateProfile:m=>M.patch(`/user/profile/${m.id}`,m)},se={class:"ml-20"},re={class:"flex items-center text-16"},de={class:"ml-12 opacity-80"},ue={class:"mt-16 flex items-center"},Pe={__name:"index",setup(m){const o=G(),k={required:!0,message:"此为必填项",trigger:["blur","change"]},[x]=g(),[S,u,A]=F();async function B(){await A(),await y.changePassword(u.value),$message.success("密码修改成功"),c()}const f=H(o.avatar),[P]=g();async function V(){if(!f.value)return $message.error("请输入头像地址"),!1;await y.updateProfile({id:o.userId,avatar:f.value}),$message.success("头像修改成功"),c()}const $=[{label:"保密",value:0},{label:"男",value:1},{label:"女",value:2}],[I]=g(),[q,s,C]=F({id:o.userId,nickName:o.nickName,gender:o.userInfo?.gender??0,address:o.userInfo?.address,email:o.userInfo?.email});async function O(){await C(),await y.updateProfile(s.value),$message.success("资料修改成功"),c()}async function c(){const R=await ee();o.setUser(R)}return(R,e)=>{const z=ae,w=W,D=Q,U=X,v=te,E=le,p=ne,i=j,N=h,J=oe,T=Z;return L(),K(T,{"show-footer":""},{default:t(()=>[a(U,null,{default:t(()=>[a(D,{align:"center"},{default:t(()=>[a(z,{round:"",size:100,src:l(o).avatar},null,8,["src"]),r("div",se,[r("div",re,[e[14]||(e[14]=r("span",null,"用户名:",-1)),r("span",de,_(l(o).username),1),a(w,{class:"ml-32",type:"primary",text:"",onClick:e[0]||(e[0]=n=>l(x).open())},{default:t(()=>[...e[13]||(e[13]=[r("i",{class:"i-fe:edit mr-4"},null,-1),d(" 修改密码 ",-1)])]),_:1})]),r("div",ue,[a(w,{type:"primary",ghost:"",onClick:e[1]||(e[1]=n=>l(P).open())},{default:t(()=>[...e[15]||(e[15]=[d(" 更改头像 ",-1)])]),_:1}),e[16]||(e[16]=r("span",{class:"ml-12 opacity-60"}," 修改头像只支持在线链接，不提供上传图片功能，如有需要可自行对接！ ",-1))])])]),_:1})]),_:1}),a(U,{class:"mt-20",title:"个人资料信息"},{"header-extra":t(()=>[a(w,{type:"primary",text:"",onClick:e[2]||(e[2]=n=>l(I).open())},{default:t(()=>[...e[17]||(e[17]=[r("i",{class:"i-fe:edit mr-4"},null,-1),d(" 修改资料 ",-1)])]),_:1})]),default:t(()=>[a(E,{"label-placement":"left","label-style":{width:"200px",textAlign:"center"},column:1,bordered:""},{default:t(()=>[a(v,{label:"昵称"},{default:t(()=>[d(_(l(o).nickName),1)]),_:1}),a(v,{label:"性别"},{default:t(()=>[d(_($.find(n=>n.value===l(o).userInfo?.gender)?.label??"未知"),1)]),_:1}),a(v,{label:"地址"},{default:t(()=>[d(_(l(o).userInfo?.address),1)]),_:1}),a(v,{label:"邮箱"},{default:t(()=>[d(_(l(o).userInfo?.email),1)]),_:1})]),_:1})]),_:1}),a(l(b),{ref_key:"avatarModalRef",ref:P,width:"420px",title:"更改头像",onOk:e[4]||(e[4]=n=>V())},{default:t(()=>[a(p,{value:l(f),"onUpdate:value":e[3]||(e[3]=n=>Y(f)?f.value=n:null)},null,8,["value"])]),_:1},512),a(l(b),{ref_key:"pwdModalRef",ref:x,title:"修改密码",width:"420px",onOk:e[7]||(e[7]=n=>B())},{default:t(()=>[a(N,{ref_key:"pwdFormRef",ref:S,model:l(u),"label-placement":"left","require-mark-placement":"left"},{default:t(()=>[a(i,{label:"原密码",path:"oldPassword",rule:k},{default:t(()=>[a(p,{value:l(u).oldPassword,"onUpdate:value":e[5]||(e[5]=n=>l(u).oldPassword=n),type:"password",placeholder:"请输入原密码","show-password-on":"mousedown"},null,8,["value"])]),_:1}),a(i,{label:"新密码",path:"newPassword",rule:k},{default:t(()=>[a(p,{value:l(u).newPassword,"onUpdate:value":e[6]||(e[6]=n=>l(u).newPassword=n),type:"password",placeholder:"请输入新密码","show-password-on":"mousedown"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},512),a(l(b),{ref_key:"profileModalRef",ref:I,title:"修改资料",width:"420px",onOk:e[12]||(e[12]=n=>O())},{default:t(()=>[a(N,{ref_key:"profileFormRef",ref:q,model:l(s),"label-placement":"left"},{default:t(()=>[a(i,{label:"昵称",path:"nickName"},{default:t(()=>[a(p,{value:l(s).nickName,"onUpdate:value":e[8]||(e[8]=n=>l(s).nickName=n),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),a(i,{label:"性别",path:"gender"},{default:t(()=>[a(J,{value:l(s).gender,"onUpdate:value":e[9]||(e[9]=n=>l(s).gender=n),options:$,placeholder:"请选择性别"},null,8,["value"])]),_:1}),a(i,{label:"地址",path:"address"},{default:t(()=>[a(p,{value:l(s).address,"onUpdate:value":e[10]||(e[10]=n=>l(s).address=n),placeholder:"请输入地址"},null,8,["value"])]),_:1}),a(i,{label:"邮箱",path:"email"},{default:t(()=>[a(p,{value:l(s).email,"onUpdate:value":e[11]||(e[11]=n=>l(s).email=n),placeholder:"请输入邮箱"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},512)]),_:1})}}};export{Pe as default};
