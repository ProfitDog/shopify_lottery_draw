import{_ as Z}from"./CommonPage-BNCiDHRf.js";import{u as ee}from"./useCrud-BqH2SHWF.js";import{bo as oe,bT as re,bU as w,bV as $,c as E,b,d as q,aS as le,a as te,f as ne,h as n,aW as se,an as ae,aq as ie,s as ce,ap as de,bf as ue,bg as me,bi as pe,bh as fe,au as be,u as ge,g as K,bO as ve,j as G,az as he,ah as C,k as Ce,l as j,b5 as A,o as _e,z as B,A as H,B as m,I as f,D as r,aM as ye,aG as O,E as U,b1 as xe,ac as Ie,al as L,J as ke,bW as ze,bX as we}from"./index-DrZMjmv9.js";import{f as $e}from"./common-Ci7I2wDr.js";import{_ as Se}from"./index-KwMPWn-_.js";import{_ as D}from"./QueryItem-CpesyAr7.js";import{_ as Re}from"./Input-AGQs7Bn2.js";import{a as Te}from"./Select-B6wqMYzm.js";import{b as Pe,_ as Ee}from"./useForm-CG-yDGX1.js";import{N as J}from"./Switch-C3KDMXR3.js";import{_ as Ae}from"./Avatar-DhZoxkIh.js";import{N as Be}from"./Tag-BrLFFiz0.js";import"./TheFooter-D-cLa1qG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppCard-C8n9dtWU.js";import"./Checkbox-BeROFyCp.js";import"./Dropdown-DuE7bwls.js";import"./create-BGkfZJ4H.js";import"./Eye-CJXJszYF.js";import"./download-C2161hUv.js";import"./utils-D5SwkeWV.js";function He(t){const{lineHeight:l,borderRadius:c,fontWeightStrong:_,baseColor:p,dividerColor:y,actionColor:W,textColor1:i,textColor2:s,closeColorHover:g,closeColorPressed:x,closeIconColor:I,closeIconColorHover:v,closeIconColorPressed:u,infoColor:a,successColor:R,warningColor:z,errorColor:o,fontSize:e}=t;return Object.assign(Object.assign({},re),{fontSize:e,lineHeight:l,titleFontWeight:_,borderRadius:c,border:`1px solid ${y}`,color:W,titleTextColor:i,iconColor:s,contentTextColor:s,closeBorderRadius:c,closeColorHover:g,closeColorPressed:x,closeIconColor:I,closeIconColorHover:v,closeIconColorPressed:u,borderInfo:`1px solid ${w(p,$(a,{alpha:.25}))}`,colorInfo:w(p,$(a,{alpha:.08})),titleTextColorInfo:i,iconColorInfo:a,contentTextColorInfo:s,closeColorHoverInfo:g,closeColorPressedInfo:x,closeIconColorInfo:I,closeIconColorHoverInfo:v,closeIconColorPressedInfo:u,borderSuccess:`1px solid ${w(p,$(R,{alpha:.25}))}`,colorSuccess:w(p,$(R,{alpha:.08})),titleTextColorSuccess:i,iconColorSuccess:R,contentTextColorSuccess:s,closeColorHoverSuccess:g,closeColorPressedSuccess:x,closeIconColorSuccess:I,closeIconColorHoverSuccess:v,closeIconColorPressedSuccess:u,borderWarning:`1px solid ${w(p,$(z,{alpha:.33}))}`,colorWarning:w(p,$(z,{alpha:.08})),titleTextColorWarning:i,iconColorWarning:z,contentTextColorWarning:s,closeColorHoverWarning:g,closeColorPressedWarning:x,closeIconColorWarning:I,closeIconColorHoverWarning:v,closeIconColorPressedWarning:u,borderError:`1px solid ${w(p,$(o,{alpha:.25}))}`,colorError:w(p,$(o,{alpha:.08})),titleTextColorError:i,iconColorError:o,contentTextColorError:s,closeColorHoverError:g,closeColorPressedError:x,closeIconColorError:I,closeIconColorHoverError:v,closeIconColorPressedError:u})}const We={common:oe,self:He},Le=E("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[b("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),q("closable",[E("alert-body",[b("title",`
 padding-right: 24px;
 `)])]),b("icon",{color:"var(--n-icon-color)"}),E("alert-body",{padding:"var(--n-padding)"},[b("title",{color:"var(--n-title-text-color)"}),b("content",{color:"var(--n-content-text-color)"})]),le({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),b("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),b("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),q("show-icon",[E("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),q("right-adjust",[E("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),E("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[b("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[te("& +",[b("content",{marginTop:"9px"})])]),b("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),b("icon",{transition:"color .3s var(--n-bezier)"})]),Oe=Object.assign(Object.assign({},K.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Ue=ne({name:"Alert",inheritAttrs:!1,props:Oe,slots:Object,setup(t){const{mergedClsPrefixRef:l,mergedBorderedRef:c,inlineThemeDisabled:_,mergedRtlRef:p}=ge(t),y=K("Alert","-alert",Le,We,t,l),W=ve("Alert",p,l),i=G(()=>{const{common:{cubicBezierEaseInOut:u},self:a}=y.value,{fontSize:R,borderRadius:z,titleFontWeight:o,lineHeight:e,iconSize:k,iconMargin:T,iconMarginRtl:P,closeIconSize:N,closeBorderRadius:F,closeSize:V,closeMargin:M,closeMarginRtl:d,padding:X}=a,{type:h}=t,{left:Q,right:Y}=he(T);return{"--n-bezier":u,"--n-color":a[C("color",h)],"--n-close-icon-size":N,"--n-close-border-radius":F,"--n-close-color-hover":a[C("closeColorHover",h)],"--n-close-color-pressed":a[C("closeColorPressed",h)],"--n-close-icon-color":a[C("closeIconColor",h)],"--n-close-icon-color-hover":a[C("closeIconColorHover",h)],"--n-close-icon-color-pressed":a[C("closeIconColorPressed",h)],"--n-icon-color":a[C("iconColor",h)],"--n-border":a[C("border",h)],"--n-title-text-color":a[C("titleTextColor",h)],"--n-content-text-color":a[C("contentTextColor",h)],"--n-line-height":e,"--n-border-radius":z,"--n-font-size":R,"--n-title-font-weight":o,"--n-icon-size":k,"--n-icon-margin":T,"--n-icon-margin-rtl":P,"--n-close-size":V,"--n-close-margin":M,"--n-close-margin-rtl":d,"--n-padding":X,"--n-icon-margin-left":Q,"--n-icon-margin-right":Y}}),s=_?Ce("alert",G(()=>t.type[0]),i,t):void 0,g=j(!0),x=()=>{const{onAfterLeave:u,onAfterHide:a}=t;u&&u(),a&&a()};return{rtlEnabled:W,mergedClsPrefix:l,mergedBordered:c,visible:g,handleCloseClick:()=>{var u;Promise.resolve((u=t.onClose)===null||u===void 0?void 0:u.call(t)).then(a=>{a!==!1&&(g.value=!1)})},handleAfterLeave:()=>{x()},mergedTheme:y,cssVars:_?void 0:i,themeClass:s?.themeClass,onRender:s?.onRender}},render(){var t;return(t=this.onRender)===null||t===void 0||t.call(this),n(se,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:l,$slots:c}=this,_={class:[`${l}-alert`,this.themeClass,this.closable&&`${l}-alert--closable`,this.showIcon&&`${l}-alert--show-icon`,!this.title&&this.closable&&`${l}-alert--right-adjust`,this.rtlEnabled&&`${l}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?n("div",Object.assign({},ae(this.$attrs,_)),this.closable&&n(ie,{clsPrefix:l,class:`${l}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&n("div",{class:`${l}-alert__border`}),this.showIcon&&n("div",{class:`${l}-alert__icon`,"aria-hidden":"true"},ce(c.icon,()=>[n(de,{clsPrefix:l},{default:()=>{switch(this.type){case"success":return n(fe,null);case"info":return n(pe,null);case"warning":return n(me,null);case"error":return n(ue,null);default:return null}}})])),n("div",{class:[`${l}-alert-body`,this.mergedBordered&&`${l}-alert-body--bordered`]},be(c.header,p=>{const y=p||this.title;return y?n("div",{class:`${l}-alert-body__title`},y):null}),c.default&&n("div",{class:`${l}-alert-body__content`},c))):null}})}}),S={create:t=>A.post("/user",t),read:(t={})=>A.get("/user",{params:t}),update:t=>A.patch(`/user/${t.id}`,t),delete:t=>A.delete(`/user/${t}`),resetPwd:(t,l)=>A.patch(`/user/password/reset/${t}`,l),getAllRoles:()=>A.get("/role?enable=1")},ao=Object.assign({name:"UserMgt"},{__name:"index",setup(t){const l=j(null),c=j({});_e(()=>{l.value?.handleSearch()});const _=[{label:"男",value:1},{label:"女",value:2}],p=j([]);S.getAllRoles().then(({data:o=[]})=>p.value=o);const{modalRef:y,modalFormRef:W,modalForm:i,modalAction:s,handleAdd:g,handleDelete:x,handleOpen:I,handleSave:v}=ee({name:"用户",initForm:{enable:!0},doCreate:S.create,doDelete:S.delete,doUpdate:S.update,refresh:()=>l.value?.handleSearch()}),u=[{title:"头像",key:"avatar",width:80,render:({avatar:o})=>n(Ae,{size:"medium",src:o})},{title:"用户名",key:"username",width:150,ellipsis:{tooltip:!0}},{title:"角色",key:"roles",width:200,ellipsis:{tooltip:!0},render:({roles:o})=>o?.length?o.map((e,k)=>n(Be,{type:"success",style:k>0?"margin-left: 8px;":""},{default:()=>e.name})):"暂无角色"},{title:"性别",key:"gender",width:80,render:({gender:o})=>_.find(e=>o===e.value)?.label??""},{title:"邮箱",key:"email",width:150,ellipsis:{tooltip:!0}},{title:"创建时间",key:"createDate",width:180,render(o){return n("span",$e(o.createTime))}},{title:"状态",key:"enable",width:120,render:o=>n(J,{size:"small",rubberBand:!1,value:o.enable,loading:!!o.enableLoading,onUpdateValue:()=>a(o)},{checked:()=>"启用",unchecked:()=>"停用"})},{title:"操作",key:"actions",width:420,align:"right",fixed:"right",hideInExcel:!0,render(o){return[we(n(L,{size:"small",type:"primary",secondary:!0},{default:()=>"超管专属",icon:()=>n("i",{class:"i-carbon:user-role text-14"})}),"SuperAdmin"),n(L,{size:"small",type:"primary",class:"ml-12px",secondary:!0,onClick:()=>R(o)},{default:()=>"分配角色",icon:()=>n("i",{class:"i-carbon:user-role text-14"})}),n(L,{size:"small",type:"primary",style:"margin-left: 12px;",onClick:()=>I({action:"reset",title:"重置密码",row:o,onOk:z})},{default:()=>"重置密码",icon:()=>n("i",{class:"i-radix-icons:reset text-14"})}),n(L,{size:"small",type:"error",style:"margin-left: 12px;",onClick:()=>x(o.id)},{default:()=>"删除",icon:()=>n("i",{class:"i-material-symbols:delete-outline text-14"})})]}}];async function a(o){o.enableLoading=!0;try{await S.update({id:o.id,enable:!o.enable}),o.enableLoading=!1,$message.success("操作成功"),l.value?.handleSearch()}catch(e){console.error(e),o.enableLoading=!1}}function R(o){const e=o.roles.map(k=>k.id);I({action:"setRole",title:"分配角色",row:{id:o.id,username:o.username,roleIds:e},onOk:z})}function z(){if(s.value==="setRole")return v({api:()=>S.update(i.value),cb:()=>$message.success("分配成功")});if(s.value==="reset")return v({api:()=>S.resetPwd(i.value.id,i.value),cb:()=>$message.success("密码重置成功")});v()}return(o,e)=>{const k=Re,T=Te,P=Ee,N=Pe,F=Ue,V=Z,M=ze("permission");return H(),B(V,null,{action:m(()=>[Ie((H(),B(r(L),{type:"primary",onClick:e[0]||(e[0]=d=>r(g)())},{default:m(()=>[...e[9]||(e[9]=[ke("i",{class:"i-material-symbols:add mr-4 text-18"},null,-1),U(" 创建新用户 ",-1)])]),_:1})),[[M,"AddUser"]])]),default:m(()=>[f(r(Se),{ref_key:"$table",ref:l,"query-items":r(c),"onUpdate:queryItems":e[4]||(e[4]=d=>ye(c)?c.value=d:null),"scroll-x":1200,columns:u,"get-data":r(S).read},{default:m(()=>[f(r(D),{label:"用户名","label-width":50},{default:m(()=>[f(k,{value:r(c).username,"onUpdate:value":e[1]||(e[1]=d=>r(c).username=d),type:"text",placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1}),f(r(D),{label:"性别","label-width":50},{default:m(()=>[f(T,{value:r(c).gender,"onUpdate:value":e[2]||(e[2]=d=>r(c).gender=d),clearable:"",options:_},null,8,["value"])]),_:1}),f(r(D),{label:"状态","label-width":50},{default:m(()=>[f(T,{value:r(c).enable,"onUpdate:value":e[3]||(e[3]=d=>r(c).enable=d),clearable:"",options:[{label:"启用",value:1},{label:"停用",value:0}]},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),f(r(xe),{ref_key:"modalRef",ref:y,width:"520px"},{default:m(()=>[f(N,{ref_key:"modalFormRef",ref:W,"label-placement":"left","label-align":"left","label-width":80,model:r(i),disabled:r(s)==="view"},{default:m(()=>[f(P,{label:"用户名",path:"username",rule:{required:!0,message:"请输入用户名",trigger:["input","blur"]}},{default:m(()=>[f(k,{value:r(i).username,"onUpdate:value":e[5]||(e[5]=d=>r(i).username=d),disabled:r(s)!=="add"},null,8,["value","disabled"])]),_:1}),["add","reset"].includes(r(s))?(H(),B(P,{key:0,label:r(s)==="reset"?"重置密码":"初始密码",path:"password",rule:{required:!0,message:"请输入密码",trigger:["input","blur"]}},{default:m(()=>[f(k,{value:r(i).password,"onUpdate:value":e[6]||(e[6]=d=>r(i).password=d),type:"password","show-password-on":"mousedown"},null,8,["value"])]),_:1},8,["label"])):O("",!0),["add","setRole"].includes(r(s))?(H(),B(P,{key:1,label:"角色",path:"roleIds"},{default:m(()=>[f(T,{value:r(i).roleIds,"onUpdate:value":e[7]||(e[7]=d=>r(i).roleIds=d),options:r(p),"label-field":"name","value-field":"id",clearable:"",filterable:"",multiple:""},null,8,["value","options"])]),_:1})):O("",!0),r(s)==="add"?(H(),B(P,{key:2,label:"状态",path:"enable"},{default:m(()=>[f(r(J),{value:r(i).enable,"onUpdate:value":e[8]||(e[8]=d=>r(i).enable=d)},{checked:m(()=>[...e[10]||(e[10]=[U(" 启用 ",-1)])]),unchecked:m(()=>[...e[11]||(e[11]=[U(" 停用 ",-1)])]),_:1},8,["value"])]),_:1})):O("",!0)]),_:1},8,["model","disabled"]),r(s)==="add"?(H(),B(F,{key:0,type:"warning",closable:""},{default:m(()=>[...e[12]||(e[12]=[U(" 详细信息需由用户本人补充修改 ",-1)])]),_:1})):O("",!0)]),_:1},512)]),_:1})}}});export{ao as default};
