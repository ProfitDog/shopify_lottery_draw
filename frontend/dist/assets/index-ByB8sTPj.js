import{_ as B}from"./CommonPage-BNCiDHRf.js";import{v as D,l as f,o as E,z as M,A as z,B as o,I as t,D as l,aM as P,E as _,b1 as F,J as L,al as p,h as r}from"./index-DrZMjmv9.js";import{u as V}from"./useCrud-BqH2SHWF.js";import{_ as T}from"./index-KwMPWn-_.js";import{_ as y}from"./QueryItem-CpesyAr7.js";import{a as d}from"./api-ugMLOsa3.js";import{b as j,_ as J}from"./useForm-CG-yDGX1.js";import{_ as O}from"./Input-AGQs7Bn2.js";import{a as G}from"./Select-B6wqMYzm.js";import{_ as H}from"./Tree-DNLilPF-.js";import{N as g}from"./Switch-C3KDMXR3.js";import"./TheFooter-D-cLa1qG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppCard-C8n9dtWU.js";import"./Checkbox-BeROFyCp.js";import"./Dropdown-DuE7bwls.js";import"./create-BGkfZJ4H.js";import"./Eye-CJXJszYF.js";import"./download-C2161hUv.js";import"./Tag-BrLFFiz0.js";const fe=Object.assign({name:"RoleMgt"},{__name:"index",setup(K){const k=D(),u=f(null),i=f({});E(()=>{u.value?.handleSearch()});const{modalRef:v,modalFormRef:h,modalAction:x,modalForm:s,handleAdd:U,handleDelete:R,handleEdit:I}=V({name:"角色",doCreate:d.create,doDelete:d.delete,doUpdate:d.update,initForm:{enable:!0},refresh:(a,e)=>u.value?.handleSearch(e)}),N=[{title:"角色名",key:"name"},{title:"角色编码",key:"code"},{title:"状态",key:"enable",render:a=>r(g,{size:"small",rubberBand:!1,value:a.enable,loading:!!a.enableLoading,disabled:a.code==="SUPER_ADMIN",onUpdateValue:()=>$(a)},{checked:()=>"启用",unchecked:()=>"停用"})},{title:"操作",key:"actions",width:320,align:"right",fixed:"right",render(a){return[r(p,{size:"small",type:"primary",secondary:!0,onClick:()=>k.push({path:`/pms/role/user/${a.id}`,query:{roleName:a.name}})},{default:()=>"分配用户",icon:()=>r("i",{class:"i-fe:user-plus text-14"})}),r(p,{size:"small",type:"primary",style:"margin-left: 12px;",disabled:a.code==="SUPER_ADMIN",onClick:()=>I(a)},{default:()=>"编辑",icon:()=>r("i",{class:"i-material-symbols:edit-outline text-14"})}),r(p,{size:"small",type:"error",style:"margin-left: 12px;",disabled:a.code==="SUPER_ADMIN",onClick:()=>R(a.id)},{default:()=>"删除",icon:()=>r("i",{class:"i-material-symbols:delete-outline text-14"})})]}}];async function $(a){a.enableLoading=!0;try{await d.update({id:a.id,enable:!a.enable}),a.enableLoading=!1,$message.success("操作成功"),u.value?.handleSearch()}catch(e){console.error(e),a.enableLoading=!1}}const b=f([]);return d.getAllPermissionTree().then(({data:a=[]})=>b.value=a),(a,e)=>{const c=O,C=G,m=J,q=H,A=j,S=B;return z(),M(S,null,{action:o(()=>[t(l(p),{type:"primary",onClick:e[0]||(e[0]=n=>l(U)())},{default:o(()=>[...e[7]||(e[7]=[L("i",{class:"i-material-symbols:add mr-4 text-18"},null,-1),_(" 新增角色 ",-1)])]),_:1})]),default:o(()=>[t(l(T),{ref_key:"$table",ref:u,"query-items":l(i),"onUpdate:queryItems":e[3]||(e[3]=n=>P(i)?i.value=n:null),"scroll-x":1200,columns:N,"get-data":l(d).read},{default:o(()=>[t(l(y),{label:"角色名","label-width":50},{default:o(()=>[t(c,{value:l(i).name,"onUpdate:value":e[1]||(e[1]=n=>l(i).name=n),type:"text",placeholder:"请输入角色名",clearable:""},null,8,["value"])]),_:1}),t(l(y),{label:"状态","label-width":50},{default:o(()=>[t(C,{value:l(i).enable,"onUpdate:value":e[2]||(e[2]=n=>l(i).enable=n),clearable:"",options:[{label:"启用",value:1},{label:"停用",value:0}]},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),t(l(F),{ref_key:"modalRef",ref:v,width:"520px"},{default:o(()=>[t(A,{ref_key:"modalFormRef",ref:h,"label-placement":"left","label-align":"left","label-width":80,model:l(s)},{default:o(()=>[t(m,{label:"角色名",path:"name",rule:{required:!0,message:"请输入角色名",trigger:["input","blur"]}},{default:o(()=>[t(c,{value:l(s).name,"onUpdate:value":e[4]||(e[4]=n=>l(s).name=n)},null,8,["value"])]),_:1}),t(m,{label:"角色编码",path:"code",rule:{required:!0,message:"请输入角色编码",trigger:["input","blur"]}},{default:o(()=>[t(c,{value:l(s).code,"onUpdate:value":e[5]||(e[5]=n=>l(s).code=n),disabled:l(x)!=="add"},null,8,["value","disabled"])]),_:1}),t(m,{label:"权限",path:"permissionIds"},{default:o(()=>[t(q,{"key-field":"id","label-field":"name",selectable:!1,data:l(b),"checked-keys":l(s).permissionIds,"on-update:checked-keys":n=>l(s).permissionIds=n,checkable:"","check-on-click":"","default-expand-all":"",class:"cus-scroll max-h-200 w-full"},null,8,["data","checked-keys","on-update:checked-keys"])]),_:1}),t(m,{label:"状态",path:"enable"},{default:o(()=>[t(l(g),{value:l(s).enable,"onUpdate:value":e[6]||(e[6]=n=>l(s).enable=n)},{checked:o(()=>[...e[8]||(e[8]=[_(" 启用 ",-1)])]),unchecked:o(()=>[...e[9]||(e[9]=[_(" 停用 ",-1)])]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},512)]),_:1})}}});export{fe as default};
