import{u as x}from"./useForm-CG-yDGX1.js";import{l as A,a$ as C,bY as m}from"./index-DrZMjmv9.js";const T={view:"查看",edit:"编辑",add:"新增"};function R({name:g,initForm:c={},doCreate:w,doDelete:p,doUpdate:h,refresh:r}){const n=A(""),[u,s]=C(),[y,i,d]=x(c);function b(e={},a){l({action:"add",title:a,row:Object.assign({},m(c),m(e))})}function O(e,a){l({action:"edit",title:a,row:e})}function $(e,a){l({action:"view",title:a,row:e})}function l(e={}){const{action:a,row:t,title:o,onOk:v}=e;n.value=a,i.value={...t},u.value?.open({...e,async onOk(){return typeof v=="function"?await v():await f()},title:o??(T[n.value]||"")+g})}async function f(e){if(!e&&!["edit","add"].includes(n.value))return!1;await d(),e=e||{add:{api:()=>w(i.value),cb:()=>$message.success("新增成功")},edit:{api:()=>h(i.value),cb:()=>$message.success("保存成功")}}[n.value];try{s.value=!0;const t=await e.api();e.cb(),s.value=!1,t&&r(t)}catch(t){return console.error(t),s.value=!1,!1}}function k(e,a){if(!e&&e!==0)return;const t=$dialog.warning({content:"确定删除？",title:"提示",positiveText:"确定",negativeText:"取消",async onPositiveClick(){try{t.loading=!0;const o=await p(e);$message.success("删除成功"),t.loading=!1,r(o,!0)}catch(o){console.error(o),t.loading=!1}},...a})}return{modalRef:u,modalFormRef:y,modalAction:n,modalForm:i,okLoading:s,validation:d,handleAdd:b,handleDelete:k,handleEdit:O,handleView:$,handleOpen:l,handleSave:f}}export{R as u};
