import{_ as B}from"./CommonPage-BNCiDHRf.js";import{w as U,l as p,o as q,z as R,A as f,B as a,I as r,D as l,aM as z,J as S,C as x,aG as $,E as _,al as d,F as D,h as s}from"./index-DrZMjmv9.js";import{f as T}from"./common-Ci7I2wDr.js";import{_ as V}from"./index-KwMPWn-_.js";import{_ as y}from"./QueryItem-CpesyAr7.js";import{a as g}from"./api-ugMLOsa3.js";import{N as w}from"./Tag-BrLFFiz0.js";import{_ as A}from"./Input-AGQs7Bn2.js";import{a as E}from"./Select-B6wqMYzm.js";import{_ as M}from"./Avatar-DhZoxkIh.js";import{N as O}from"./Switch-C3KDMXR3.js";import"./TheFooter-D-cLa1qG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppCard-C8n9dtWU.js";import"./Checkbox-BeROFyCp.js";import"./Dropdown-DuE7bwls.js";import"./create-BGkfZJ4H.js";import"./Eye-CJXJszYF.js";import"./download-C2161hUv.js";import"./utils-D5SwkeWV.js";const j={class:"flex items-center"},F={key:0,class:"i-material-symbols:delete-outline mr-4 text-18"},G={key:0,class:"i-line-md:confirm-circle mr-4 text-18"},de=Object.assign({name:"RoleUser"},{__name:"role-user",setup(J){const m=U(),u=p(null),n=p({});q(()=>{u.value?.handleSearch()});const b=[{label:"男",value:1},{label:"女",value:2}],I=[{type:"selection",fixed:"left"},{title:"头像",key:"avatar",width:80,render:({avatar:t})=>s(M,{size:"medium",src:t})},{title:"用户名",key:"username",width:150,ellipsis:{tooltip:!0}},{title:"角色",key:"roles",width:200,ellipsis:{tooltip:!0},render:({roles:t})=>t?.length?t.map((e,c)=>s(w,{type:"success",style:c>0?"margin-left: 8px;":""},{default:()=>e.name})):"暂无角色"},{title:"性别",key:"gender",width:80,render:({gender:t})=>b.find(e=>t===e.value)?.label??""},{title:"创建时间",key:"createDate",width:180,render(t){return s("span",T(t.createTime))}},{title:"状态",key:"enable",width:100,render:t=>s(O,{size:"small",rubberBand:!1,value:t.enable},{checked:()=>"启用",unchecked:()=>"停用"})},{title:"操作",key:"actions",width:100,align:"right",fixed:"right",hideInExcel:!0,render(t){return t.roles?.some(e=>e.id===+m.params.roleId)?s(d,{size:"small",type:"error",secondary:!0,onClick:()=>h([t.id])},{default:()=>"取消授权",icon:()=>s("i",{class:"i-material-symbols:delete-outline text-14"})}):s(d,{size:"small",type:"primary",secondary:!0,onClick:()=>v([t.id])},{default:()=>"授权",icon:()=>s("i",{class:"i-line-md:confirm-circle text-14"})})}}],i=p([]);function N(t){i.value=t||[]}function v(t=i.value){const e=m.params.roleId;if(!e)return $message.error("角色异常，请重新选择角色");if(!t.length)return $message.error("请先选择用户");$dialog.confirm({content:`确认分配【${m.query.roleName}】？`,async confirm(){await g.addRoleUsers(e,{userIds:t}),u.value?.handleSearch()}})}function h(t=i.value){const e=m.params.roleId;if(!e)return $message.error("角色异常，请重新选择角色");if(!t.length)return $message.error("请先选择用户");$dialog.confirm({content:`确认取消分配【${m.query.roleName}】？`,async confirm(){await g.removeRoleUsers(e,{userIds:t}),u.value?.handleSearch()}})}return(t,e)=>{const c=A,k=E,C=B;return f(),R(C,{back:""},{"title-suffix":a(()=>[r(l(w),{class:"ml-12",type:"warning"},{default:a(()=>[_(D(l(m).query.roleName),1)]),_:1})]),action:a(()=>[S("div",j,[r(l(d),{disabled:!l(i).length,type:"error",onClick:e[0]||(e[0]=o=>h())},{default:a(()=>[l(i).length?(f(),x("i",F)):$("",!0),e[6]||(e[6]=_(" 批量取消授权 ",-1))]),_:1},8,["disabled"]),r(l(d),{class:"ml-12",disabled:!l(i).length,type:"primary",onClick:e[1]||(e[1]=o=>v())},{default:a(()=>[l(i).length?(f(),x("i",G)):$("",!0),e[7]||(e[7]=_(" 批量授权 ",-1))]),_:1},8,["disabled"])])]),default:a(()=>[r(l(V),{ref_key:"$table",ref:u,"query-items":l(n),"onUpdate:queryItems":e[5]||(e[5]=o=>z(n)?n.value=o:null),"scroll-x":1200,columns:I,"get-data":l(g).getAllUsers,onOnChecked:N},{default:a(()=>[r(l(y),{label:"用户名","label-width":50},{default:a(()=>[r(c,{value:l(n).username,"onUpdate:value":e[2]||(e[2]=o=>l(n).username=o),type:"text",placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1}),r(l(y),{label:"性别","label-width":50},{default:a(()=>[r(k,{value:l(n).gender,"onUpdate:value":e[3]||(e[3]=o=>l(n).gender=o),clearable:"",options:b},null,8,["value"])]),_:1}),r(l(y),{label:"状态","label-width":50},{default:a(()=>[r(k,{value:l(n).enable,"onUpdate:value":e[4]||(e[4]=o=>l(n).enable=o),clearable:"",options:[{label:"启用",value:1},{label:"停用",value:0}]},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"])]),_:1})}}});export{de as default};
